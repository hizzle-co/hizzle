(()=>{"use strict";var e={n:n=>{var r=n&&n.__esModule?()=>n.default:()=>n;return e.d(r,{a:r}),r},d:(n,r)=>{for(var t in r)e.o(r,t)&&!e.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:r[t]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=window.wp.domReady;var r=e.n(n);const t=window.wp.element,s=window.wp.components,i=window.React,o=window.hizzlewp.interface,a=window.hizzlewp.components,l=window.wp.data,c=window.wp.notices,d=window.ReactJSXRuntime;function u(){const{notices:e}=(0,l.useSelect)((e=>({notices:e(c.store).getNotices()})),[]),{removeNotice:n}=(0,l.useDispatch)(c.store),r=e.filter((({isDismissible:e,type:n})=>e&&"default"===n)),t=e.filter((({isDismissible:e,type:n})=>!e&&"default"===n));return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(s.NoticeList,{notices:t,className:"components-editor-notices__pinned"}),(0,d.jsx)(s.NoticeList,{notices:r,className:"components-editor-notices__dismissible",onRemove:n})]})}function p(){const e=(0,l.useSelect)((e=>e(c.store).getNotices()),[]),{removeNotice:n}=(0,l.useDispatch)(c.store),r=e.filter((({type:e})=>"snackbar"===e)).slice(-3);return(0,d.jsx)(s.SnackbarList,{notices:r,className:"components-editor-notices__snackbar",onRemove:n})}const m=window.hizzlewp.history,h=window.hizzlewp.store,x=({children:e})=>(0,d.jsx)("div",{className:"hizzlewp-upsell-card",children:e}),j=({upsell:e})=>{if(!e)return null;const{content:n,buttonURL:r,buttonText:t}=e;return(0,d.jsx)(x,{children:(0,d.jsxs)(s.Tip,{children:[n,(0,d.jsx)(s.Button,{href:r,target:"_blank",variant:"link",children:t})]})})},g=()=>{const{config:e}=(0,h.useProvidedCollectionConfig)(),{path:n}=(0,m.useRoute)(),r=`/${e.namespace}/${e.collection}`,t=(0,i.useMemo)((()=>{const t=[];return e?(r===n?t.push({text:e.labels?.add_new_item||"Add New",onClick:()=>(0,m.updatePath)(`${r}/add`),variant:"primary"}):t.push({text:e.labels?.view_items||"View Items",onClick:()=>(0,m.updatePath)(r),variant:"primary"}),e.routes&&Object.entries(e.routes).forEach((([e,{title:n,...r}])=>{t.push({text:n,onClick:r.href?void 0:()=>(0,m.updatePath)(e),...r})})),t):t}),[e,n]);return(0,d.jsxs)(s.Card,{isRounded:!1,children:[(0,d.jsxs)(s.CardHeader,{as:s.__experimentalHStack,children:[(0,d.jsxs)(s.__experimentalHeading,{level:1,size:18,variant:"muted",children:[e.labels?.name||"Items",(0,d.jsx)(s.Slot,{name:`${r}/title`,children:e=>Array.isArray(e)&&e.length>0&&(0,d.jsxs)(a.ErrorBoundary,{children:[(0,d.jsx)(s.__experimentalText,{variant:"muted",children:"/"}),(0,d.jsx)(s.__experimentalText,{children:e})]})})]}),(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(s.__experimentalHStack,{expanded:!1,children:t.map((e=>(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(s.Button,{...e})},e.text)))})})]}),(0,d.jsx)(s.CardBody,{children:(0,d.jsxs)(s.__experimentalVStack,{children:[(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(m.Outlet,{path:"/:namespace/:collection"})}),(0,d.jsx)(s.Slot,{name:"noptin-interface-notices"}),e.fills&&e.fills.map((e=>(0,d.jsx)(s.Fill,{name:`${e.name}`,children:(0,d.jsxs)(a.ErrorBoundary,{children:[e.content&&(0,d.jsx)("span",{dangerouslySetInnerHTML:{__html:e.content}}),e.upsell&&(0,d.jsx)(j,{upsell:e.upsell})]})},e.name)))]})})]})},_=({children:e})=>{const{config:n,isResolving:r,hasResolved:t,error:i}=(0,h.useProvidedCollectionConfig)();return r||!t?(0,d.jsx)(s.Spinner,{}):i||!n?(0,d.jsx)(s.Notice,{status:"error",isDismissible:!1,children:i?.message||"An unknown error occurred."}):(0,d.jsx)(a.ErrorBoundary,{children:e})},y=({defaultNamespace:e,defaultCollection:n})=>{const{params:r}=(0,m.useRoute)(),t=r?.get("namespace")||e,s=r?.get("collection")||n,i=r?.get("id");return(0,d.jsx)(h.CollectionProvider,{namespace:t,collection:s,recordId:i,children:(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(_,{children:(0,d.jsx)(g,{})})})})},f=window.hizzlewp.records,w=()=>{const{config:{namespace:e,collection:n,props:r,ignore:t}}=(0,h.useProvidedCollectionConfig)()||{},l=(0,m.useQuery)(),c=(0,h.useCollectionRecords)(e,n,l),{preferences:u,setPreferences:p}=(0,o.usePreferences)("recordsTablePreferences",`${e}/${n}`),x=(0,i.useMemo)((()=>{const e=[];return r.forEach((n=>{n.is_textarea&&!n.is_tokens&&(!n.enum||Array.isArray(n.enum))||t.includes(n.name)||"hide"===n.js_props?.table||e.push({accessorKey:n.name,header:n.label,enableSorting:!n.is_dynamic&&!n.is_meta,enableHiding:!n.is_primary})})),e}),[r,t]),j=(0,i.useMemo)((()=>{const e=l.orderby,n=l.order||"desc";return{...u,sorting:e?[{id:e,desc:"desc"===n}]:u?.sorting||[],pagination:{pageSize:l.per_page||u?.pagination?.pageSize||25,pageIndex:l.paged?Number(l.paged)-1:0}}}),[c.records,l,u,p]),g=(0,i.useCallback)((e=>{p(e),(0,m.updateQueryString)({orderby:e?.sorting?.[0]?.id||"",order:e?.sorting?.[0]?.desc?"desc":"asc",per_page:`${e?.pagination?.pageSize||25}`,paged:`${(e?.pagination?.pageIndex||0)+1}`})}),[p]);return c.isResolving||!c.hasResolved?(0,d.jsx)("div",{className:"hizzlewp-records-table-loading",children:(0,d.jsx)(s.Spinner,{})}):"ERROR"===c.status?(0,d.jsx)(s.Notice,{status:"error",isDismissible:!1,children:c.error?.message||"An unknown error occurred."}):(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(f.Table,{rowCount:c.totalItems||0,data:c.records||[],columns:x,enableSorting:!0,enableFiltering:!0,enablePagination:!0,state:j,onChange:g})})},b=window.wp.i18n,v=({record:e,onChange:n,schema:r,hidden:t,ignore:o,onSubmit:l,loading:c,slotName:u,submitText:p})=>{const m=(0,i.useMemo)((()=>((e,n,r)=>e.map((e=>e.readonly||e.is_dynamic||"metadata"===e.name||Array.isArray(n)&&n.includes(e.name)||Array.isArray(r)&&r.includes(e.name)?null:(e=>{const n={default:e.default,label:e.label,el:"input",type:"text",name:e.name,isInputToChange:!0};return e.js_props?.setting&&(n.customAttributes=e.js_props.setting),e.js_props?.conditions&&(n.conditions=e.js_props?.conditions),e.is_tokens?(n.el="form_token",n.suggestions=e.suggestions):e.enum&&!Array.isArray(e.enum)?(n.el="select",n.options=e.enum,e.multiple&&(n.el="multi_checkbox")):e.is_textarea&&(n.el="textarea"),(e.is_numeric||e.is_float)&&(n.type="number"),e.is_date&&(n.type="datetime-local",n.placeholder="YYYY-MM-DDTHH:MM:SS+ZZ:ZZ"),e.is_boolean&&(n.type="toggle"),e.description&&e.description!==e.label&&(n.description=e.description),n})(e))).filter((e=>!!e)))(r,t,o)),[r,t,o]);return(0,d.jsxs)(s.__experimentalVStack,{as:"form",spacing:4,style:{opacity:c?.5:1},onSubmit:l,children:[m.map((r=>(0,d.jsx)(a.Setting,{settingKey:r.name,saved:e,setAttributes:n,setting:r},r.name))),u&&(0,d.jsx)(s.Slot,{name:u,children:e=>Array.isArray(e)?e.map(((e,n)=>(0,d.jsx)(s.Tip,{children:e},n))):e}),(0,d.jsx)(s.Button,{className:"hizzlewp-block-button",variant:"primary",onClick:l,isBusy:c,__next40pxDefaultSize:!0,children:c?(0,d.jsx)(s.Spinner,{}):p})]})},S=()=>{const{config:{namespace:e,collection:n,props:r,hidden:t,ignore:s,defaultProps:o,labels:a}}=(0,h.useProvidedCollectionConfig)()||{},{saveCollectionRecord:u}=(0,l.useDispatch)(h.store),[p,x]=(0,i.useState)(!1),[j,g]=(0,i.useState)({}),_=[...s,...Object.keys(o||{})],{createErrorNotice:y,createSuccessNotice:f,removeAllNotices:w}=(0,l.useDispatch)(c.store),S=(0,i.useCallback)((r=>{r?.preventDefault(),p||(w(),x(!0),u(e,n,{...j,...o},{throwOnError:!0}).then((({id:r})=>{f((0,b.__)("Record saved successfully.","newsletter-optin-box"),{isDismissible:!0,type:"default"}),(0,m.updatePath)(`/${e}/${n}/${r}`)})).catch((e=>{y(e.message,{isDismissible:!0,type:"default"})})).finally((()=>{x(!1)})))}),[j,o,e,n,u,y,f,w]);return(0,d.jsx)(v,{record:j,onChange:e=>g({...j,...e}),onSubmit:S,submitText:a?.save_item||(0,b.__)("Save","newsletter-optin-box"),schema:r,hidden:t,ignore:_,loading:p,slotName:`${e}_${n}_record_create_below`})},C=({children:e})=>(0,d.jsx)(s.FlexBlock,{children:(0,d.jsx)(a.ErrorBoundary,{children:e})}),B=()=>{const{config:{namespace:e,collection:n,labels:r}}=(0,h.useProvidedCollectionConfig)()||{};return(0,d.jsxs)(s.__experimentalHStack,{alignment:"flex-start",wrap:!0,children:[(0,d.jsx)(s.Fill,{name:`/${e}/${n}/title`,children:r?.add_new_item||"Add New Item"}),(0,d.jsx)(C,{children:(0,d.jsx)(S,{})}),(0,d.jsx)(s.Slot,{name:`${e}_${n}_record_create_upsell`,children:e=>e?(0,d.jsx)(C,{children:e}):null})]})},N=({defaultNamespace:e,defaultCollection:n})=>{const r=(0,i.useMemo)((()=>[{path:"/:namespace/:collection",element:(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(y,{defaultNamespace:e,defaultCollection:n})}),index:(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(w,{})}),children:[{path:"/:namespace/:collection/add",element:(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(B,{})})},{path:"/:namespace/:collection/import",element:(0,d.jsx)(a.ErrorBoundary,{children:"TODO"})},{path:"/:namespace/:collection/export",element:(0,d.jsx)(a.ErrorBoundary,{children:"TODO"})},{path:"/:namespace/:collection/:recordId",element:(0,d.jsx)(a.ErrorBoundary,{children:"TODO"}),index:(0,d.jsx)(a.ErrorBoundary,{children:"TODO"}),children:[{path:"/:namespace/:collection/:recordId/:tab",element:(0,d.jsx)(a.ErrorBoundary,{children:"TODO"})}]}]}]),[e,n]);return(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(m.Router,{basePath:`/${e}/${n}`,routes:r})})},E=e=>(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(o.Header,{...e})});function z({defaultNamespace:e,defaultCollection:n,...r}){const t=(0,i.useMemo)((()=>(0,d.jsxs)(s.__experimentalVStack,{style:{padding:20},children:[(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(N,{defaultNamespace:e,defaultCollection:n})}),(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(p,{})}),(0,d.jsx)(a.ErrorBoundary,{children:(0,d.jsx)(u,{})})]})),[e,n]);return(0,d.jsx)(o.Interface,{className:"hizzlewp-settings__interface",header:(0,d.jsx)(E,{...r}),content:t})}const{collection:k,namespace:R,...P}=window.hizzleWPStore?.data||{};r()((()=>{const e=document.getElementById("hizzlewp-store-ui");if(!e||!k||!R)return;const n=()=>(0,d.jsx)(s.SlotFillProvider,{children:(0,d.jsx)(z,{defaultNamespace:R,defaultCollection:k,...P})});(0,t.createRoot)(e).render((0,d.jsx)(n,{}))}))})();