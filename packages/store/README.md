# Store

This package contains store utilities for the HizzleWP framework.

### Installation

```bash
npm install @hizzlewp/store
composer require hizzle/store
```

### Usage

```tsx
import { useCollectionRecords } from '@hizzlewp/store';

// In your component, use the useRecords hook to get the records.
export ListRecords = ( {per_page} ) => {
    const { data, total, summary, isResolving, hasResolutionFailed, getResolutionError } = useCollectionRecords( 'noptin', 'subscribers', { per_page } );

    // Check if the records are still loading.
    if ( isResolving() ) {
        return <div>Loading...</div>;
    }

    // Check if the records failed to load.
    if ( hasResolutionFailed() ) {
        return <div>Error: { getResolutionError() }</div>;
    }

    // Render the records.
    return (
        <div>
            <ul>
                { data.map( ( record ) => <li key={ record.id }>{ record.email }</li> ) }
            </ul>
            <p>Total: { total }</p>
            <p>Summary: { summary }</p>
        </div>
    );
}
```

### API

## Collection Provider

The `CollectionProvider` component is used to provide the collection context to the component tree.

```tsx
import { CollectionProvider } from '@hizzlewp/store';

<CollectionProvider namespace="noptin" collection="subscribers" recordId={ 123 }>
    <SubscriberDetails />
</CollectionProvider>
```

recordId is optional. If provided, the component will be rendered with the record context.

<!-- START TOKEN(Autogenerated collection provider|src/collection-provider.tsx) -->

### CollectionProvider

Context provider component for providing a collection.

_Parameters_

-   _props_ `Object`: The component's props.
-   _props.namespace_ `string`: The collection namespace.
-   _props.collection_ `string`: The collection name.
-   _props.recordId_ `number`: The record ID.
-   _props.children_ `*`: The children to wrap.

_Returns_

-   `Object`: The provided children, wrapped with the collection's context provider.

### useProvidedCollection

Hook that returns the current collection.

_Returns_

-   `NamespaceCollection|undefined`: The collection config from context.

### useProvidedCollectionConfig

Hook that returns the current collection config.

### useProvidedRecordId

Hook that returns the closest current record ID.

_Parameters_

-   _namespace_ `string`: The namespace of the collection to use, if not provided, the current namespace will be used.
-   _collection_ `string`: The collection name to use, if not provided, the current collection will be used.

_Returns_

-   `number|undefined`: The current record ID from context.

<!-- END TOKEN(Autogenerated collection provider|src/collection-provider.tsx) -->

## Actions

The following set of dispatching action creators are available on the object returned by `wp.data.dispatch( 'hizzlewp/store' )`:

<!-- START TOKEN(Autogenerated actions|src/actions.ts) -->

### addCollectionConfig

Returns an action object used in adding new collection config.

_Parameters_

-   _config_ `CollectionConfig`: Collection config.

_Returns_

-   `CollectionConfigAction`: Action object.

### batch

Runs multiple store actions at the same time using one API request.

Example:

    const [ savedRecord, updatedRecord, deletedRecord ] =
      await dispatch( 'hizzlewp/store' ).batch( [
        ( { saveCollectionRecord } ) => saveCollectionRecord( 'noptin', 'subscribers', { email: 'john@doe.com', name: 'John Doe' } ),
        ( { saveEditedCollectionRecord } ) => saveEditedCollectionRecord( 'noptin', 'subscribers', 123 ),
        ( { deleteCollectionRecord } ) => deleteCollectionRecord( 'noptin', 'subscribers', 123, null ),
      ] );

_Parameters_

-   _requests_ `Array`: Array of functions which are invoked simultaneously. Each function is passed an object containing `saveCollectionRecord`, `saveEditedCollectionRecord`, and `deleteCollectionRecord`.

_Returns_

-   `(thunkArgs: Object) => Promise`: A promise that resolves to an array containing the return values of each function given in `requests`.

### createUndoLevel

Forces the creation of a new undo level.

_Returns_

-   `Object`: Action object.

### deleteCollectionRecord

Action triggered to delete a collection record.

_Parameters_

-   _namespace_ `string`: Namespace of the deleted collection.
-   _collection_ `string`: Name of the deleted collection.
-   _recordId_ `number|string`: Record ID of the deleted record.
-   _query_ `?Object`: Special query parameters for the DELETE API call.

### editCollectionRecord

Returns an action object that triggers an edit to a collection record.

_Parameters_

-   _namespace_ `string`: Namespace of the edited collection.
-   _collection_ `string`: Collection of the edited collection.
-   _recordId_ `number|string`: Record ID of the edited collection record.
-   _edits_ `Object`: The edits.
-   _options_ `Object`: Options for the edit.
-   _options.undoIgnore_ `[boolean]`: Whether to ignore the edit in undo history or not.

_Returns_

-   `Object`: Action object.

### receiveCollectionRecords

Returns an action object used in signalling that entity records have been received.

_Parameters_

-   _namespace_ `string`: Namespace of the received entity records.
-   _collection_ `string`: Collection of the received entity records.
-   _records_ `Array`: Records received.
-   _query_ `?Object`: Query Object.
-   _invalidateCache_ `?boolean`: Should invalidate query caches.
-   _persistedEdits_ `?Object`: Edits to reset.
-   _meta_ `?Object`: Meta information about pagination.

_Returns_

-   `Object`: Action object.

### redo

Action triggered to redo the last undone edit to a collection record, if any.

### removeItems

Returns an action object used in signalling that collection records have been deleted and they need to be removed from collections state.

_Parameters_

-   _namespace_ `string`: Namespace of the removed collection.
-   _collection_ `string`: Collection of the removed collection.
-   _records_ `Array|number|string`: Record IDs of the removed entities.
-   _invalidateCache_ `boolean`: Controls whether we want to invalidate the cache.

_Returns_

-   `Object`: Action object.

### saveCollectionRecord

Action triggered to save an collection record.

_Parameters_

-   _namespace_ `string`: Namespace of the collection.
-   _collection_ `string`: Collection name.
-   _data_ `Object`: Record to be saved.
-   _options_ `Object`: Options for the action.
-   _options.throwOnError_ `boolean`: If false, this action suppresses all the exceptions. Defaults to false.
-   _options.fetchHandler_ `Function`: The fetch handler to use. Defaults to apiFetch.

### saveEditedCollectionRecord

Action triggered to save a collection record's edits.

_Parameters_

-   _namespace_ `string`: Namespace of the collection.
-   _collection_ `string`: Collection name.
-   _recordId_ `Object`: ID of the record.
-   _options_ `Object=`: Saving options.

### saveSpecifiedCollectionRecordEdits

Action triggered to save only specified properties for the collection record.

_Parameters_

-   _namespace_ `string`: Namespace of the collection.
-   _collection_ `string`: Collection name.
-   _recordId_ `number|string`: ID of the record.
-   _itemsToSave_ `Array`: List of record properties or property paths to save.
-   _options_ `Object`: Saving options.

### undo

Action triggered to undo the last edit to a collection record, if any.


<!-- END TOKEN(Autogenerated actions|src/actions.ts) -->

## Selectors

The following set of selectors are available on the object returned by `wp.data.select( 'hizzlewp/store' )`:

<!-- START TOKEN(Autogenerated selectors|src/selectors.ts) -->

<!-- END TOKEN(Autogenerated selectors|src/selectors.ts) -->

## Hooks

The following set of react hooks are available to import from the `@hizzlewp/store` package:

<!-- START TOKEN(Autogenerated hooks|src/hooks/index.ts) -->

<!-- END TOKEN(Autogenerated hooks|src/hooks/index.ts) -->
